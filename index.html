<!DOCTYPE html>
<html lang="ja">
	<head>
		<title>濱ゼミ研究用</title>
		<meta charset="UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
		<script src='https://cdn.firebase.com/js/client/2.4.1/firebase.js'></script>
		<link href="css/style.css" rel="stylesheet">
		<script>
			value = 0;
			receiving = true; // 受信者
			fire = new Firebase('https://test-83442.firebaseio.com/');     // ファイアーベース
			array = ["1", "2", "3"]; // 配列
			c_array = ["b-blue", "b-red", "b-yellow"]

			// データベースの値によってラジオボタンや表示を変える
			function changeElement (val) {
				$(".result").text(array[val]);
				value = val;
				$('input[type="radio"][value="'+ val +'"]').prop("checked",true);
				$(".receiving").removeClass(function(index, className) {
					return (className.match(/\bb-\S+/g) || []).join(' ');
				});
				$(".receiving").addClass(c_array[val]);
			}

			$(function(){
				// 最初は受信者を隠す
				if (receiving) {
					$(".sending").hide();
				}

				// 新しく追加されたとき
				fire.on("child_added", function(snapshot){
					changeElement(snapshot.val());
				});

				// 変更されたとき
				fire.on("child_changed", function(snapshot){
					changeElement(snapshot.val());
				});

				// チェックボックスを押されたとき
				$('input[type="radio"][name="value"]').on('click', function(){
					value = $(this).val(); 
					fire.update({"value": value});
				});

				// ボタンを押したときの遷移
				$('button').on('click', function(){
					if(receiving) {
						// 受信者ならば、送信者が見えるように
						$(".sending").show();
						$(".receiving").hide();
						receiving = false;
					} else {
						// 送信者ならば、受信者が見えるように
						$(".sending").hide();
						$(".receiving").show();
						receiving = true;
					}
				});


			});
		</script>
	</head>
	<body>
		<div class="sending">
			<h1>送信者</h1>
			<ul>
				<li>
					<input type="radio" name="value" value="0" checked>
					<label for="">1</label>
				</li>
				<li>
					<input type="radio" name="value" value="1" >
					<label for="">2</label>
				</li>
				<li>
					<input type="radio" name="value" value="2" >
					<label for="">3</label>
				</li>
			</ul>
			<button>受信者へ</button>
		</div>
		<div class="receiving">
			<h1>受信者</h1>
			<p class="result"></p>
			<button>送信者へ</button>
		</div>
	</body>
</html>